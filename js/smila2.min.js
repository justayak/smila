Smila=function(){function e(a){return"undefined"!==typeof a}function d(a){return"[smila2]["+(new Date).toISOString().substring(12)+"]"+a}function c(a){console.log(d(a))}function t(a){function b(){null!==p&&p.begin();var l=Date.now(),f=0;-1!==a.lastTime&&(f=l-a.lastTime);a.lastTime=l;var l=f/A,d=a.context,e=a.renderItems,m=a.camera(),g=m.real.x,h=m.real.y,c=a.dimension.w+20,k=a.dimension.h+20,n=g+a.dimension.w,t=h+a.dimension.h;d.clearRect(g-10,h-10,c,k);m.render(d);null!==a.onUpdate&&a.onUpdate.call(this,
    l,f);null!==a.pkmnMap&&a.pkmnMap.renderBackground(d,g,h,c,k);for(m=0;m<e.length;m+=1)c=e[m],c.update&&c.update(l,f),c.x+c.w>=g&&c.x<=n&&c.y+c.h>=h&&c.y<=t&&c.render(d);null!==a.pkmnMap&&a.pkmnMap.renderTopLayer(d);null!==p&&p.end();a._ispaused||(a.thread=requestAnimationFrame(b))}function f(){for(var b=a.renderItems,d,c,e,m=1;m<b.length;m++){d=b[m];e=d.z;for(c=m;0<c&&b[c-1].z>e;)b[c]=b[c-1],c-=1;b[c]=d}a._ispaused||(a.sortThread=setTimeout(f,250))}a.thread=requestAnimationFrame(b);a.sortThread=setTimeout(f,
    250)}function y(){this.pointer<this.frames.length-1&&(this.pointer+=1)}function q(){this.pointer=this.pointer<this.frames.length-1?this.pointer+1:0}function r(){0==this.pointer?this.forward=!0:this.pointer===this.frames.length-1&&(this.forward=!1);this.pointer=this.forward?this.pointer+1:this.pointer-1}function u(a,b,f){c("loading Sprite {"+a.key+"}");var l=new Image;l.onload=function(){c("loaded Sprite {"+a.key+"}");var f=document.createElement("canvas");f.width=l.width;f.height=l.height;f.getContext("2d").drawImage(l,
    0,0);k[a.key]=f;b.call(z)};l.onerror=function(){c("Could not load Sprite {"+a.key+"}");f.call(z)};a.key in k?(c("Load Sprite "+a.key+" from Cache"),setTimeout(b,1)):"undefined"!==typeof a.base64?(c("Load Sprite "+a.key+" from base64"),l.src=a.base64):(c("Load Sprite "+a.key+" from URL: {"+a.src+"}"),l.src=a.src)}if(!window.CanvasRenderingContext2D)throw d("Smila-Rendering is not supported by the browser! (#1)");var n={log:c,isDefined:e,logStr:d},p=null,A=Math.floor(1E3/60),s=n.Renderer=function(a,b){e(b)||(b={});var f=document.getElementById(a);0===f.style.position.length&&(f.style.position="relative");this.loadingId=a+"loading";var c=document.createElement("div");c.innerHTML="loading..";c.style.fontFamily="monospace";c.style.color="white";c.id=this.loadingId;c.style.backgroundColor="cornflowerblue";c.style.position="relative";c.style.marginTop="-"+(f.clientHeight+4)+"px";c.style.display="none";c.style.width="100%";c.style.height="100%";var d=document.createElement("canvas");d.height=f.clientHeight;
    d.width=f.clientWidth;this.renderItems=[];this.pkmnMap=null;this.isLoading=!1;this.mousePosition={x:0,y:0};this.dimension={w:f.clientWidth,h:f.clientHeight};e(Stats)&&(p=new Stats,p.domElement.style.position="absolute",p.domElement.style.left="0px",p.domElement.style.top="0px",document.body.appendChild(p.domElement));this.context=d.getContext("2d");this._ispaused=!1;this.sortThread=this.thread=this.lastTime=-1;this.onUpdate=null;f.appendChild(d);f.appendChild(c);if("trackMouse"in b&&b.trackMouse){var g=
        this;d.onmousemove=function(a){var b=d.getBoundingClientRect();g.mousePosition.x=a.clientX-b.left;g.mousePosition.y=a.clientY-b.top}}this._camera=new v(this);t(this)};s.prototype.camera=function(){return this._camera};s.prototype.loading=function(a){this.isLoading!==a&&(this.isLoading=a,document.getElementById(this.loadingId).style.display=a?"block":"none")};s.prototype.pause=function(){this._ispaused=!0;cancelAnimationFrame(this.thread);clearTimeout(this.sortThread)};s.prototype.putPkmnMap=function(a){this.pkmnMap=
    a};s.prototype.resume=function(){if(!this._ispaused)throw d("Cannot resume unpaused Renderer!");cancelAnimationFrame(this.thread);clearTimeout(this.sortThread);this._ispaused=!1;t(this)};s.prototype.add=function(a){this.renderItems.push(a)};var g=n.Sprite=function(a,b){e(b)||(b={});this.img=a;this.w=e(b.h)?b.h:a.height;this.h=e(b.w)?b.w:a.width;this.w_2=Math.floor(this.w/2);this.h_2=Math.floor(this.h/2);this.oy=this.ox=0;this.zIndexByYPos=e(b.zIndexByYPos)?b.zIndexByYPos:!1;this.y=this.x=0;this.z=
    e(b.z)?b.z|0:0;this.angleInRadians=0;this.tl_x=this.x-this.w_2;this.tl_y=this.y-this.h_2;this.mirrorx=this.mirrory=!1};g.prototype.width=function(a){return 0<arguments.length?(this.w=a,this.w_2=Math.floor(a/2),this):this.w};g.prototype.height=function(a){return 0<arguments.length?(this.h=a,this.h_2=Math.floor(a/2),this):this.h};g.prototype.positionCenter=function(a,b){return 0<arguments.length?(this.x=a,this.y=b,this.tl_x=a-this.w_2,this.tl_y=b-this.h_2,this):{x:this.x,y:this.y}};g.prototype.position=
    function(a,b){return 0<arguments.length?(this.tl_x=a,this.tl_y=b,this.x=a+this.w_2,this.y=b+this.h_2,this):{x:this.tl_x,y:this.tl_y}};g.prototype.render=function(a){var b=this.x,f=this.y,c=this.w,d=this.h,e=.5+c/2<<0,g=.5+d/2<<0,h=this.mirrorx,k=this.mirrory;a.translate(b,f);0!==this.angleInRadians&&a.rotate(this.angleInRadians);k&&h?a.scale(-1,-1):k?a.scale(-1,1):h&&a.scale(1,-1);a.drawImage(this.img,this.ox,this.oy,c,d,-e,-g,c,d);k&&h?a.scale(1,1):k?a.scale(-1,1):h&&a.scale(1,-1);0!==this.angleInRadians&&
a.rotate(-this.angleInRadians);a.translate(-b,-f)};g.prototype.subimage=function(a,b){this.ox=a*this.w;this.oy=b*this.h;return this};g.prototype.directImage=function(a,b,c,d){this.ox=a;this.oy=b;this.width(c);this.height(d)};g.prototype.verticalMirror=function(a){this.mirrory=a};g.prototype.horizontalMirror=function(a){this.mirrorx=a};var h=n.Animation=function(a,b){if(!e(b))throw d("Animation needs options");if(!e(b.frames))throw d("Animation needs frames");b.w=b.frames[0].w;b.h=b.frames[0].h;g.call(this,
    a,b);this.forward=!0;this.elapsedTime=0;this.isStoped=!0;this.pointer=0;this.frames=b.frames;switch(e(b.animationType)?b.animationType:h.Type.ONCE){case h.Type.BOUNCE:this.subupdate=r;break;case h.Type.ENDLESS:this.subupdate=q;break;case h.Type.ONCE:this.subupdate=y}};h.prototype=Object.create(g.prototype);h.prototype.play=function(){this.isStoped=!1;return this};h.prototype.pause=function(){this.isStoped=!0;return this};h.prototype.reset=function(){this.isStoped=!0;this.pointer=0;return this};h.prototype.update=
    function(a,b){if(!this.isStoped)if(1===this.frames.length)this.directImage(this.frames[0].ox,this.frames[0].oy,this.frames[0].w,this.frames[0].h);else{var c=this.frames[this.pointer];this.width(c.w);this.height(c.h);this.directImage(c.ox,c.oy,c.w,c.h);this.elapsedTime>=c.time&&(this.elapsedTime=0,this.subupdate());this.elapsedTime+=b}};h.Type={BOUNCE:0,ONCE:1,ENDLESS:2};var w=n.UniformSprite=function(a,b){if(!e(b))throw d("Uniform Sprite needs options");if(!e(b.w))throw d("Uniform Sprite needs width option");
    if(!e(b.h))throw d("Uniform Sprite needs height option");g.call(this,a,b)};w.prototype=Object.create(g.prototype);var x=n.Entity=function(a,b){if(!e(b))throw d("Entity needs options");if(!e(b.animations))throw d("Entity needs animations");this.frames=[];this.elapsedTime=this.pointer=0;this.currentState="";this.animations=b.animations;this.subupdate=function(){};w.call(this,a,b)};x.prototype=Object.create(w.prototype);x.prototype.animate=function(a){if(a!==this.currentState){var b=this.animations[a];
    if(b)switch(this.currentState=a,this.pointer=0,this.frames=b.frames,b.animationType){case h.Type.BOUNCE:this.subupdate=r;break;case h.Type.ENDLESS:this.subupdate=q;break;case h.Type.ONCE:this.subupdate=y}return this}};x.prototype.update=function(a,b){var c=this.frames;0!==c.length&&(1===c.length?this.subimage(c[0].ux,c[0].uy):(c=c[this.pointer],this.subimage(c.ux,c.uy),this.elapsedTime>=c.time&&(this.elapsedTime=0,this.subupdate()),this.elapsedTime+=b))};var v=n.Camera=function(a){this.offset={x:0,
    y:0};this.real={x:0,y:0};this.renderer=a};v.prototype.translate=function(a,b){this.offset.x=a;this.offset.y=b;0===a&&0===b?(this.real.x=Math.round(this.real.x),this.real.y=Math.round(this.real.y)):(this.real.x-=a,this.real.y-=b)};v.prototype.render=function(a){a.translate(this.offset.x,this.offset.y)};v.prototype.set=function(a,b){this.translate(this.real.x-a,this.real.y-b);this.render(this.renderer.context);this.translate(0,0)};var k={},z=n.DataStore={put:function(a,b){var c=[];a instanceof Array?
    a.forEach(function(e){u(e,function(){c.push(0);c.length===a.length&&b()},function(){throw d("Cannot load url: "+e.src);})}):u(a,b,function(){throw d("Cannot load url: "+a.src);})},get:function(a,b){if(a in k)return new g(k[a],b);throw d("Could not find key {"+a+"}");},_get_raw_:function(a){if(a in k)return k[a];throw d("Could not find key {"+a+"}");},getAnimation:function(a,b){if(a in k)return new h(k[a],b);throw d("Could not find key {"+a+"}");},getUniform:function(a,b){if(a in k)return new w(k[a],
    b);throw d("Could not find key {"+a+"}");},getEntity:function(a,b){if(a in k)return new x(k[a],b);throw d("Could not find key {"+a+"}");}};return n}();
(function(){for(var e=0,d=["ms","moz","webkit","o"],c=0;c<d.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[d[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[c]+"CancelAnimationFrame"]||window[d[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(c,d){var q=(new Date).getTime(),r=Math.max(0,16-(q-e)),u=window.setTimeout(function(){c(q+r)},r);e=q+r;return u});window.cancelAnimationFrame||(window.cancelAnimationFrame=
    function(c){clearTimeout(c)})})();